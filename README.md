# ESJ Novel Downloader

![Version](https://img.shields.io/github/v/release/mikoto710/esj-novel-downloader?label=version) ![License](https://img.shields.io/github/license/mikoto710/esj-novel-downloader) ![Language](https://img.shields.io/badge/language-TypeScript-blue)

ä¸€ä¸ªç”¨äº **ESJZone** çš„ Tampermonkey è„šæœ¬ã€‚  
æ”¯æŒ **TXT / EPUB ä¸‹è½½**ï¼Œå¹¶é€‚é…å¤šç§é¡µé¢ç±»å‹ï¼ˆå°è¯´è¯¦æƒ…é¡µ / å•ç« é˜…è¯»é¡µ / è®ºå›åˆ—è¡¨é¡µï¼‰ã€‚



## åŠŸèƒ½ç‰¹æ€§

- ğŸ“š **å¤šæ ¼å¼å¯¼å‡º**ï¼šæ”¯æŒ **TXT** å’Œ **EPUB**ï¼ˆè‡ªåŠ¨å†…åµŒå°é¢ï¼‰ã€‚
- âš¡ **æé€Ÿä¸‹è½½**ï¼šå¤šçº¿ç¨‹å¹¶å‘æŠ“å–ï¼Œæ”¯æŒç”¨æˆ·é…ç½®ã€‚
- ğŸ’¾ **æ–­ç‚¹ç»­ä¼ **ï¼šä½¿ç”¨ IndexedDB ä½œä¸ºç¼“å­˜ï¼Œåˆ·æ–°é¡µé¢æˆ–å…³é—­æµè§ˆå™¨ä¸ä¸¢å¤±è¿›åº¦ã€‚
- ğŸ›¡ï¸ **æ™ºèƒ½è¡¥æ¼**ï¼šè‡ªåŠ¨æ£€æµ‹æŠ“å–å¤±è´¥çš„ç« èŠ‚å¹¶å°è¯•é‡è¯•ï¼Œç¡®ä¿å†…å®¹å®Œæ•´ã€‚
- ğŸ§© **å¤šé¡µé¢é€‚é…**ï¼šæ”¯æŒè¯¦æƒ…é¡µã€è®ºå›ç‰ˆå—ã€å•ç« é˜…è¯»é¡µå¤šç§åœºæ™¯ã€‚
- ğŸ–¼ï¸ **æ­£æ–‡æ’å›¾ä¸‹è½½**ï¼šæ”¯æŒä¸‹è½½æ­£æ–‡æ—¶é™„å¸¦æ’å›¾ï¼ˆæµ‹è¯•åŠŸèƒ½ï¼‰ã€‚

> ğŸ’¡ æŠ“å–é€»è¾‘éƒ¨åˆ†å‚è€ƒè‡ª [ESJ-novel-backup](https://github.com/ZALin/ESJ-novel-backup)ï¼Œæ„Ÿè°¢åŸé¡¹ç›®ä½œè€…æä¾›çš„æŠ“å–æ€è·¯



## é¡µé¢æ”¯æŒ
| é¡µé¢ç±»å‹ | æ”¯æŒåŠŸèƒ½ | å¯¹åº”æ¨¡å— | é“¾æ¥æ ¼å¼ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- |
| **å°è¯´è¯¦æƒ…é¡µ** | ğŸŸ¢ å…¨æœ¬ä¸‹è½½ (TXT/EPUB) | `scrapers/detail.ts` | `.../detail/123.html` |
| **è®ºå›åˆ—è¡¨é¡µ** | ğŸŸ¢ å…¨æœ¬ä¸‹è½½ (TXT/EPUB) | `scrapers/forum.ts` | `.../forum/123/456/` |
| **å•ç« é˜…è¯»é¡µ** | ğŸ”µ å•ç« å¯¼å‡º (TXT) | `scrapers/single.ts` | `.../forum/123/456.html` |



## å®‰è£…æ–¹å¼

### 1. å®‰è£…è„šæœ¬ç®¡ç†å™¨

- [Tampermonkey](https://www.tampermonkey.net/) (æ¨è)
- Violentmonkey

### 2. å®‰è£…è„šæœ¬

[ğŸ‘‰ **ç‚¹å‡»è¿™é‡Œç›´æ¥å®‰è£…æœ€æ–°ç‰ˆ**](https://github.com/mikoto710/esj-novel-downloader/releases/latest/download/esj-novel-downloader.user.js) 

æˆ–å‰å¾€ [GreasyFork å‘å¸ƒé¡µ](https://greasyfork.org/zh-CN/scripts/562046-esjzone-%E5%85%A8%E6%9C%AC%E4%B8%8B%E8%BD%BD) 
 / æœ¬ GitHub ä»“åº“çš„ [Releases é¡µé¢](https://github.com/mikoto710/esj-novel-downloader/releases) æ‰‹åŠ¨ä¸‹è½½ã€‚

## ä½¿ç”¨æ–¹æ³•

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰é¡µé¢ç±»å‹å¹¶æ³¨å…¥æŒ‰é’®ï¼š

1.  **å°è¯´è¯¦æƒ…é¡µ / è®ºå›ç‰ˆå—é¡µ**ï¼š
    -   ç‚¹å‡»æ³¨å…¥çš„ **â€œå…¨æœ¬ä¸‹è½½â€** æŒ‰é’®ã€‚
    -   ç¡®è®¤ä¸‹è½½åï¼Œä¼šå‡ºç°è¿›åº¦å¼¹çª—ï¼ˆæ”¯æŒæœ€å°åŒ–ï¼‰ã€‚
    -   å®Œæˆåé€‰æ‹©å¯¼å‡ºæ ¼å¼å³å¯ã€‚

2.  **å•ç« é˜…è¯»é¡µ**ï¼š
    -   åœ¨é¡¶éƒ¨å¯¼èˆªæ ä¸­é—´ "â‰¡" æ—ä¼šå‡ºç°ä¸‹è½½æŒ‰é’®ã€‚
    -   ç‚¹å‡»ç›´æ¥ä¸‹è½½å½“å‰ç« èŠ‚çš„ TXT æ–‡ä»¶ã€‚



åœ¨**å°è¯´è¯¦æƒ…é¡µ / è®ºå›ç‰ˆå—é¡µ**çš„ "**å…¨æœ¬ä¸‹è½½**" æŒ‰é’®æ—è¾¹ï¼Œæä¾›äº† **â€œè®¾ç½®â€ (âš™ï¸)** æŒ‰é’®ï¼Œç‚¹å‡»å¯è¿›è¡Œé…ç½®ï¼š

- **ä¸‹è½½çº¿ç¨‹æ•°**ï¼šè°ƒæ•´å¹¶å‘è¯·æ±‚æ•°é‡ï¼ˆé»˜è®¤ä¸º 5ï¼Œå»ºè®® 1-5ï¼‰ï¼Œå¹³è¡¡é€Ÿåº¦ä¸ç¨³å®šæ€§ã€‚
- **æ¸…ç©ºç¼“å­˜**ï¼šæ‰‹åŠ¨æ¸…ç† IndexedDB ä¸­çš„æ–­ç‚¹ç»­ä¼ æ•°æ®ã€‚
- **ä¸‹è½½æ­£æ–‡æ’å›¾**ï¼š å¼€å¯åå¯åœ¨ç”Ÿæˆçš„ EPUB å°è¯´æ–‡ä»¶ä¸­åŠ å…¥å¯¹åº”çš„æ’å›¾ã€‚



> **Note**: é¦–æ¬¡ä¸‹è½½é•¿ç¯‡å°è¯´æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šè¯·æ±‚å­˜å‚¨æƒé™ä»¥ä¿å­˜ç¼“å­˜æ•°æ®ï¼Œè¯·å…è®¸ä»¥ç¡®ä¿æŒä¹…åŒ–å­˜å‚¨ç”Ÿæ•ˆã€‚



## å¼€å‘ä¸æ„å»º

æœ¬é¡¹ç›®åŸºäº **TypeScript** å¼€å‘ï¼Œä½¿ç”¨ **Rollup** + **esbuild** è¿›è¡Œæ„å»ºã€‚

### é¡¹ç›®ç»“æ„

```
src
â”œâ”€â”€ core                 # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ config.ts        # ç”¨æˆ·é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ downloader.ts    # é€šç”¨ä¸‹è½½æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ epub.ts          # EPUB ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ parser.ts        # HTML è§£æå™¨
â”‚   â”œâ”€â”€ state.ts         # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ storage.ts       # æŒä¹…åŒ–å­˜å‚¨å±‚
â”œâ”€â”€ scrapers             # é¡µé¢æŠ“å–ç­–ç•¥å±‚
â”‚   â”œâ”€â”€ detail.ts        # é’ˆå¯¹ [å°è¯´è¯¦æƒ…é¡µ] çš„æŠ“å–é€»è¾‘
â”‚   â”œâ”€â”€ forum.ts         # é’ˆå¯¹ [è®ºå›åˆ—è¡¨é¡µ] çš„æŠ“å–é€»è¾‘
â”‚   â””â”€â”€ single.ts        # é’ˆå¯¹ [å•ç« æ­£æ–‡é¡µ] çš„æŠ“å–é€»è¾‘
â”œâ”€â”€ ui                   # ç•Œé¢äº¤äº’å±‚
â”‚   â”œâ”€â”€ components.ts    # é€šç”¨ UI ç»„ä»¶
â”‚   â”œâ”€â”€ detail.ts        # ç›®å½•é¡µ UI æ³¨å…¥
â”‚   â”œâ”€â”€ forum.ts         # è®ºå›é¡µ UI æ³¨å…¥
â”‚   â”œâ”€â”€ single.ts        # å•ç« é¡µ UI æ³¨å…¥
â”‚   â”œâ”€â”€ popups.ts        # å¼¹çª—ç»„ä»¶åº“
â”‚   â”œâ”€â”€ styles.ts        # CSS æ ·å¼å®šä¹‰
â”‚   â””â”€â”€ tray.ts          # æœ€å°åŒ–æ‚¬æµ®çƒç»„ä»¶
â”œâ”€â”€ utils                # é€šç”¨å·¥å…·åº“
â”‚   â”œâ”€â”€ dom.ts           # DOM æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ image.ts         # å›¾ç‰‡å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ index.ts         # åŸºç¡€å·¥å…·
â”‚   â””â”€â”€ text.ts          # æ–‡æœ¬å¤„ç†å·¥å…·
â”œâ”€â”€ global.d.ts          # å…¨å±€ç±»å‹å£°æ˜
â”œâ”€â”€ index.ts             # é¡¹ç›®æ€»å…¥å£
â””â”€â”€ types.ts             # TypeScript ç±»å‹å®šä¹‰æ¥å£
```

### æœ¬åœ°æ„å»º
éœ€è¦ Node.js 14+ ç¯å¢ƒ

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. å¼€å‘æ¨¡å¼ (ç›‘å¬æ–‡ä»¶å˜æ›´è‡ªåŠ¨æ„å»º)
npm run watch

# 3. ç”Ÿäº§æ„å»º (ç”Ÿæˆæœ€ç»ˆ user.js)
npm run build
```

æ„å»ºäº§ç‰©ä½äºï¼š`dist/esj-novel-downloader.user.js`
