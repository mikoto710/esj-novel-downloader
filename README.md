# ESJ Novel Downloader

![Version](https://img.shields.io/github/v/release/mikoto710/esj-novel-downloader?label=version) ![License](https://img.shields.io/github/license/mikoto710/esj-novel-downloader) ![Language](https://img.shields.io/badge/language-TypeScript-blue)

ä¸€ä¸ªç”¨äº **ESJZone** çš„ Tampermonkey è„šæœ¬ã€‚  
æ”¯æŒ **TXT / EPUB / HTML ä¸‹è½½**ï¼Œå¹¶é€‚é…å¤šç§é¡µé¢ç±»å‹ (å°è¯´è¯¦æƒ…é¡µ / å•ç« é˜…è¯»é¡µ / è®ºå›åˆ—è¡¨é¡µ)ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“š **å¤šæ ¼å¼å¯¼å‡º**: æ”¯æŒ **TXT**ã€**EPUB** å’Œ **HTML**ï¼Œæ”¯æŒè‡ªåŠ¨å†…åµŒå°é¢ã€‚
- âš¡ **æé€Ÿä¸‹è½½**: å¤šçº¿ç¨‹å¹¶å‘æŠ“å–ï¼Œæ”¯æŒç”¨æˆ·é…ç½®ã€‚
- ğŸ’¾ **æ–­ç‚¹ç»­ä¼ **: ä½¿ç”¨ IndexedDB ä½œä¸ºç¼“å­˜ï¼Œåˆ·æ–°é¡µé¢æˆ–å…³é—­æµè§ˆå™¨ä¸ä¸¢å¤±è¿›åº¦ã€‚
- ğŸ›¡ï¸ **æ™ºèƒ½è¡¥æ¼**: è‡ªåŠ¨æ£€æµ‹æŠ“å–å¤±è´¥çš„ç« èŠ‚å¹¶å°è¯•é‡è¯•ï¼Œç¡®ä¿å†…å®¹å®Œæ•´ã€‚
- ğŸ§© **å¤šé¡µé¢é€‚é…**: æ”¯æŒè¯¦æƒ…é¡µã€è®ºå›ç‰ˆå—ã€å•ç« é˜…è¯»é¡µå¤šç§åœºæ™¯ã€‚
- ğŸ–¼ï¸ **æ­£æ–‡æ’å›¾ä¸‹è½½**: æ”¯æŒå¯¼å‡º EPUB / HTML æ—¶é™„å¸¦æ’å›¾ã€‚**(åŠŸèƒ½å°šæœªå®Œå…¨æµ‹è¯•ï¼Œä¸ä¿è¯ç¨³å®šæ€§ï¼Œè°¨æ…ä½¿ç”¨)**

> ğŸ’¡ æŠ“å–é€»è¾‘éƒ¨åˆ†å‚è€ƒè‡ª [ESJ-novel-backup](https://github.com/ZALin/ESJ-novel-backup)ï¼Œæ„Ÿè°¢åŸé¡¹ç›®ä½œè€…æä¾›çš„æŠ“å–æ€è·¯

## é¡µé¢æ”¯æŒ

| é¡µé¢ç±»å‹       | æ”¯æŒåŠŸèƒ½                    | å¯¹åº”æ¨¡å—             | é“¾æ¥æ ¼å¼ç¤ºä¾‹             |
| :------------- | :-------------------------- | :------------------- | :----------------------- |
| **å°è¯´è¯¦æƒ…é¡µ** | ğŸŸ¢ å…¨æœ¬ä¸‹è½½ (TXT/EPUB/HTML) | `scrapers/detail.ts` | `.../detail/123.html`    |
| **è®ºå›åˆ—è¡¨é¡µ** | ğŸŸ¢ å…¨æœ¬ä¸‹è½½ (TXT/EPUB/HTML) | `scrapers/forum.ts`  | `.../forum/123/456/`     |
| **å•ç« é˜…è¯»é¡µ** | ğŸ”µ å•ç« å¯¼å‡º (TXT)           | `scrapers/single.ts` | `.../forum/123/456.html` |

## å®‰è£…æ–¹å¼

### 1. å®‰è£…è„šæœ¬ç®¡ç†å™¨

- [Tampermonkey](https://www.tampermonkey.net/) (æ¨è)
- Violentmonkey

### 2. å®‰è£…è„šæœ¬

[ğŸ‘‰ **ç‚¹å‡»è¿™é‡Œç›´æ¥å®‰è£…æœ€æ–°ç‰ˆ**](https://github.com/mikoto710/esj-novel-downloader/releases/latest/download/esj-novel-downloader.user.js)

æˆ–å‰å¾€ [GreasyFork å‘å¸ƒé¡µ](https://greasyfork.org/zh-CN/scripts/562046-esjzone-%E5%85%A8%E6%9C%AC%E4%B8%8B%E8%BD%BD)
/ æœ¬ GitHub ä»“åº“çš„ [Releases é¡µé¢](https://github.com/mikoto710/esj-novel-downloader/releases) æ‰‹åŠ¨ä¸‹è½½ã€‚

## ä½¿ç”¨æ–¹æ³•

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰é¡µé¢ç±»å‹å¹¶æ³¨å…¥æŒ‰é’®:

1.  **å°è¯´è¯¦æƒ…é¡µ / è®ºå›ç‰ˆå—é¡µ**:
    - ç‚¹å‡»æ³¨å…¥çš„ **â€œå…¨æœ¬ä¸‹è½½â€** æŒ‰é’®ã€‚
    - ç¡®è®¤ä¸‹è½½åï¼Œä¼šå‡ºç°è¿›åº¦å¼¹çª—(æ”¯æŒæœ€å°åŒ–)ã€‚
    - å®Œæˆåé€‰æ‹©å¯¼å‡ºæ ¼å¼å³å¯ï¼Œè‹¥å¼€å¯æ’å›¾ä¸‹è½½ï¼Œä¼šæ˜¾ç¤ºå›¾ç‰‡çš„æ‹‰å–æƒ…å†µã€‚

2.  **å•ç« é˜…è¯»é¡µ**:
    - åœ¨é¡¶éƒ¨å¯¼èˆªæ ä¸­é—´ "â‰¡" æ—ä¼šå‡ºç°ä¸‹è½½æŒ‰é’®ã€‚
    - ç‚¹å‡»ç›´æ¥ä¸‹è½½å½“å‰ç« èŠ‚çš„ TXT æ–‡ä»¶ã€‚

åœ¨**å°è¯´è¯¦æƒ…é¡µ / è®ºå›ç‰ˆå—é¡µ**çš„ **"å…¨æœ¬ä¸‹è½½"** æŒ‰é’®æ—è¾¹ï¼Œæä¾›äº† **"è®¾ç½®" (âš™ï¸)** æŒ‰é’®ï¼Œç‚¹å‡»å¯è¿›è¡Œé…ç½®:

- **ä¸‹è½½çº¿ç¨‹æ•°**: è°ƒæ•´å¹¶å‘è¯·æ±‚æ•°é‡ (é»˜è®¤ä¸º 5ï¼Œå»ºè®® 1-5)ï¼Œå¹³è¡¡é€Ÿåº¦ä¸ç¨³å®šæ€§ã€‚
- **ä¸‹è½½æ­£æ–‡æ’å›¾**: å¼€å¯åå¯åœ¨ç”Ÿæˆçš„ EPUB å°è¯´æ–‡ä»¶ä¸­åŠ å…¥å¯¹åº”çš„æ’å›¾ï¼Œè‹¥æŠ“å–å¤±è´¥ä¼šæ’å…¥å¯¹åº”çš„ img æ ‡ç­¾ã€‚
- **æ¸…ç©ºç¼“å­˜**: æ‰‹åŠ¨æ¸…ç† IndexedDB ä¸­çš„æ–­ç‚¹ç»­ä¼ æ•°æ®ã€‚

> **Note**: å¼€å¯ä¸‹è½½æ­£æ–‡æ’å›¾åŠŸèƒ½åè„šæœ¬ç®¡ç†å™¨ä¼šè¯·æ±‚è·¨åŸŸè®¿é—®æƒé™ï¼Œè¯·å…è®¸ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸æ‹‰å–æŸäº›å›¾åºŠå›¾ç‰‡ã€‚

## å¼€å‘ä¸æ„å»º

æœ¬é¡¹ç›®åŸºäº **TypeScript** å¼€å‘ï¼Œä½¿ç”¨ **Rollup** + **esbuild** è¿›è¡Œæ„å»ºã€‚

### é¡¹ç›®ç»“æ„

```
src
â”œâ”€â”€ core                 # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ config.ts        # ç”¨æˆ·é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ downloader.ts    # é€šç”¨ä¸‹è½½æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ epub.ts          # EPUB ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ html.ts          # å•é¡µ HTML ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ parser.ts        # HTML è§£æå™¨
â”‚   â”œâ”€â”€ state.ts         # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ storage.ts       # æŒä¹…åŒ–å­˜å‚¨å±‚
â”œâ”€â”€ scrapers             # é¡µé¢æŠ“å–ç­–ç•¥å±‚
â”‚   â”œâ”€â”€ detail.ts        # é’ˆå¯¹ [å°è¯´è¯¦æƒ…é¡µ] çš„æŠ“å–é€»è¾‘
â”‚   â”œâ”€â”€ forum.ts         # é’ˆå¯¹ [è®ºå›åˆ—è¡¨é¡µ] çš„æŠ“å–é€»è¾‘
â”‚   â””â”€â”€ single.ts        # é’ˆå¯¹ [å•ç« æ­£æ–‡é¡µ] çš„æŠ“å–é€»è¾‘
â”œâ”€â”€ ui                   # ç•Œé¢äº¤äº’å±‚
â”‚   â”œâ”€â”€ components.ts    # é€šç”¨ UI ç»„ä»¶
â”‚   â”œâ”€â”€ detail.ts        # ç›®å½•é¡µ UI æ³¨å…¥
â”‚   â”œâ”€â”€ forum.ts         # è®ºå›é¡µ UI æ³¨å…¥
â”‚   â”œâ”€â”€ single.ts        # å•ç« é¡µ UI æ³¨å…¥
â”‚   â”œâ”€â”€ popups.ts        # å¼¹çª—ç»„ä»¶åº“
â”‚   â”œâ”€â”€ styles.ts        # CSS æ ·å¼å®šä¹‰
â”‚   â””â”€â”€ tray.ts          # æœ€å°åŒ–æ‚¬æµ®çƒç»„ä»¶
â”œâ”€â”€ utils                # é€šç”¨å·¥å…·åº“
â”‚   â”œâ”€â”€ dom.ts           # DOM æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ image.ts         # å›¾ç‰‡å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ index.ts         # åŸºç¡€å·¥å…·
â”‚   â””â”€â”€ text.ts          # æ–‡æœ¬å¤„ç†å·¥å…·
â”œâ”€â”€ global.d.ts          # å…¨å±€ç±»å‹å£°æ˜
â”œâ”€â”€ index.ts             # é¡¹ç›®æ€»å…¥å£
â””â”€â”€ types.ts             # TypeScript ç±»å‹å®šä¹‰æ¥å£
```

### æœ¬åœ°æ„å»º

éœ€è¦ **Node.js 18+** ç¯å¢ƒï¼Œä¸ GitHub Actions æœ€ä½ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œæ¨èä½¿ç”¨ **Node.js 22.22.0 LTS**

```bash
# 1. å®‰è£…ä¾èµ– (æ¨èä½¿ç”¨ npm ci)
# npm install
npm ci

# 2. å¼€å‘æ¨¡å¼ (ç›‘å¬æ–‡ä»¶å˜æ›´è‡ªåŠ¨æ„å»º)
npm run watch

# 3. ä»£ç æ ¼å¼åŒ– (éå¿…é¡»ï¼Œå»ºè®®æäº¤å‰æ‰§è¡Œ)
npm run format

# 3. ç”Ÿäº§æ„å»º (ç”Ÿæˆæœ€ç»ˆ user.js)
npm run build
```

æ„å»ºäº§ç‰©ä½äº: `dist/esj-novel-downloader.user.js`
